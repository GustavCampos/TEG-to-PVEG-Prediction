{% extends "base_template.html" %}

{% block content %}
    <section class="section">
        <div class="container">
            <h1 class="title">Dashboard de Predição TEGxPVEG</h1>
            
            <!-- Tabs -->
            <div class="tabs is-centered">
                <ul>
                    <li class="is-active">
                        <a class="tabLink" id="overviewTab">Visão Geral</a>
                    </li>
                    <li><a class="tabLink" id="rawDataTab">Dados de Requisição</a></li>
                </ul>
            </div>

            <!-- Analysis Tab -->
            <div id="overviewTabContent">
                <!-- Overview Section -->
                <div class="overview">
                    <div class="block">
                        <nav class="level">
                            <div class="level-item has-text-centered">
                                <div>
                                    <p class="heading">Energia Gerada</p>
                                    <p class="title">
                                        <span class="format-value-num">
                                            {{ result_dict['wanted_kWh_energy'] }}
                                        </span>
                                        kW
                                    </p>
                                </div>
                            </div>

                            <div class="level-item has-text-centered">
                                <div>
                                    <p class="heading">Biomassa Consumida</p>
                                    <p class="title">
                                        <span class="format-value-num">
                                            {{ result_dict['teg']['total_kg_biomass'] }}
                                        </span>
                                        kg
                                    </p>
                                </div>
                            </div>

                            <div class="level-item has-text-centered">
                                <div>
                                    <p class="heading">CO<sub>2</sub> Emitido</p>
                                    <p class="title">
                                        <span class="format-value-num">
                                            {{ result_dict['teg']['emitted_kg_co2_amount'] }}
                                        </span>
                                        kg
                                    </p>
                                </div>
                            </div>
                    
                            <div class="level-item has-text-centered">
                                <div>
                                    <p class="heading">Área total de painéis</p>
                                    <p class="title">
                                        <span class="format-value-num">
                                            {{ result_dict['pvpanel']['total_area'] }}
                                        </span>
                                         m<sup>2</sup>
                                    </p>
                                </div>
                            </div>
                        </nav>
                    </div>

                    <hr>

                    <div class="is-flex is-justify-content-space-between">
                        <span class="title is-5">Período de Análise:</span>
                    
                        <div>
                            <span id="start-date">{{ result_dict['date_range']['start'] }}</span>
                            -
                            <span id="end-date">{{ result_dict['date_range']['end'] }}</span>
                        </div>
                    </div>
                </div>

                <!-- Specific metrics boxes -->
                <div class="columns">
                    <!-- TEG Section -->
                    <div class="column is-flex">
                        <div class="box is-flex-grow-1">
                            <h2 class="subtitle">Métricas de Geração Termoelétrica</h2>

                            <div class="columns is-multiline">
                                <div class="column">
                                    <div class="metric-field block">
                                        <p><strong>Horas Diárias de Trabalho:</strong></p>
                                        <p><span class="format-value-num">
                                                {{ request_dict["daily-work-hours"] }}
                                            </span>
                                        </p>
                                    </div>
                                </div>
                                
                                <div class="column">
                                    <div class="metric-field block">
                                        <p><strong>Horas Totais de Trabalho:</strong></p>
                                        <p><span class="format-value-num">
                                                {{ result_dict["teg"]["total_work_hours"] }}
                                            </span>
                                        </p>
                                    </div>
                                </div>
                            </div>

                            <div class="columns">                                
                                <div class="column">
                                    <h3>Métricas da Queima</h3>
                                    
                                    <div class="metric-field block">
                                        <p><strong>Biomassa Consumida por Hora:</strong></p>
                                        <p><span class="format-value-num">
                                                {{ result_dict["teg"]["hourly_biomass"] }}
                                            </span> kg
                                        </p>
                                    </div>

                                    <div class="metric-field block">
                                        <p><strong>Biomassa Total Consumida:</strong></p>
                                        <p><span class="format-value-num">
                                                {{ result_dict["teg"]["total_kg_biomass"] }}
                                            </span> kg
                                        </p>
                                    </div>

                                    <div class="metric-field block">
                                        <p><strong>CO<sub>2</sub> Gerado:</strong></p>
                                        <p><span class="format-value-num">
                                                {{ result_dict["teg"]["emitted_kg_co2_amount"] }}
                                            </span> kg
                                        </p>
                                    </div>

                                    <div class="metric-field block">
                                        <p><strong>Calor da Queima:</strong></p>
                                        <p><span class="format-value-num">
                                                {{ result_dict["teg"]["combustion_heat"] }}
                                            </span> MJ
                                        </p>
                                    </div>
                                </div>

                                <div class="column">
                                    <h3>Métrica do Módulo Termoelétrico</h3>

                                    <div class="metric-field block">
                                        <p><strong>Energia Gerada por Hora:</strong></p>
                                        <p><span class="format-value-num">
                                                {{ result_dict["teg"]["hourly_kwh_power_output"] }}
                                            </span> kWh
                                        </p>
                                    </div>

                                    <div class="metric-field block">
                                        <p><strong>Calor no Módulo:</strong></p>
                                        <p><span class="format-value-num">
                                                {{ result_dict["teg"]["module_heat"] }}
                                            </span> MJ
                                        </p>
                                    </div>

                                    <div class="metric-field block">
                                        <p><strong>Quantidade de Módulos:</strong></p>
                                        <p><span class="">
                                                {{ request_dict["module-quantity"] }}
                                            </span>
                                        </p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- PV Panel Section -->
                    <div class="column is-flex">
                        <div class="box is-flex-grow-1">
                            <h2 class="subtitle">Métricas de Geração Fotovoltaica</h2>
                            
                            <div class="columns">
                                <div class="column">
                                    <h3>Métricas do Módulo Fotovoltaico</h3>

                                    <div class="metric-field block">
                                        <p><strong>Coeficiente de Temperatura:</strong></p>
                                        <p><span class="format-value-num">
                                                {{ result_dict["pvpanel"]["module"]["TEMPERATURE_COEFFICIENT"] * 100 }}
                                            </span>% /ºC
                                        </p>
                                    </div>

                                    <div class="metric-field block">
                                        <p><strong>Temperatura de Referência:</strong></p>
                                        <p><span class="format-value-num">
                                                {{ result_dict["pvpanel"]["module"]["REFERENCE_TEMPERATURE"] }}
                                            </span> ºC
                                        </p>
                                    </div>

                                    <div class="metric-field block">
                                        <p><strong>Área de Painel Único:</strong></p>
                                        <p><span class="format-value-num">
                                                {{ result_dict["pvpanel"]["module"]["SINGLE_PANEL_AREA"] }}
                                            </span> m<sup>2</sup>
                                        </p>
                                    </div>

                                    <div class="metric-field block">
                                        <p><strong>Eficiência do Módulo:</strong></p>
                                        <p><span class="format-value-num">
                                                {{ result_dict["pvpanel"]["module"]["EFFICIENCY"] * 100 }}
                                            </span>%
                                        </p>
                                    </div>
                                </div>

                                <div class="column">
                                    <h3>Métricas de Geração</h3>

                                    <div class="metric-field block">
                                        <p><strong>Energia Total Gerada por Painel:</strong></p>
                                        <p><span class="format-value-num">
                                                {{ result_dict["pvpanel"]["total_kWh_output"] }}
                                            </span> kW
                                        </p>
                                    </div>

                                    <div class="metric-field block">
                                        <p><strong>Área Total de Necessária:</strong></p>
                                        <p><span class="format-value-num">
                                                {{ result_dict["pvpanel"]["total_area"] }}
                                            </span> m<sup>2</sup>
                                        </p>
                                    </div>

                                    <div class="metric-field block">
                                        <p><strong>Número de Painéis Aproximado:</strong></p>
                                        <p id="panel-number">
                                            <span>{{ result_dict["pvpanel"]["total_area"] }}</span>
                                            <span>{{ result_dict["pvpanel"]["module"]["SINGLE_PANEL_AREA"] }}</span>
                                        </p>
                                    </div>

                                    <div class="metric-field block">
                                        <p><strong>Energia Total Gerada:</strong></p>
                                        <p><span id="panel-number-x-pout" class="format-value-num">
                                                {{ result_dict["pvpanel"]["total_kWh_output"] }}
                                            </span> kW
                                        </p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Charts Section -->
                <div class="columns is-centered is-multiline">
                    <div class="column">
                        <div class="box">
                            <canvas id="hourly-temp-pout-chart"></canvas>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Raw Data Section -->
            <div id="rawDataTabContent" class="is-hidden">
                <div class="columns">
                    <div class="column">
                        <div class="block box">
                            <h2 class="subtitle">Dados de Inseridos</h2>
                            <pre>{{ request_json }}</pre>
                        </div>
                    </div>

                    <div class="column">
                        <div class="block box">
                            <h2 class="subtitle">Dados de Resposta</h2>
                            <pre>{{ response_json }}</pre>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <script>
        // Passing variables to js/analysis_result_charts.js
        const startDate = '{{ result_dict['date_range']['start'] }}';
        sessionStorage.setItem("startDate", startDate);

        const hourlyData = '{{ result_dict['pvpanel']['hourly_data'] | tojson }}';
        sessionStorage.setItem("hourlyData", hourlyData);
    </script>

    <script src="{{ url_for('static', filename='js/analysis_result.js') }}"></script>
    <script src="{{ url_for('static', filename='js/analysis_result_charts.js') }}"></script>
{% endblock %}
